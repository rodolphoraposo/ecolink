<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>Ecolink - Sistema de Gest√£o de Res√≠duos</title>
    <link rel="stylesheet" href="../css/login.css" />
    <!-- Removido jsPDF: agora o comprovante √© gerado como imagem PNG via canvas -->
  </head>

  <body>
    <a
      class="back-home"
      href="../../index.html"
      title="Voltar para a Home"
      aria-label="Voltar para a Home"
    >
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
        <path d="M3 12l9-8 9 8" fill="none" stroke="currentColor" stroke-width="2" />
        <path d="M5 10v10h5v-6h4v6h5V10" fill="none" stroke="currentColor" stroke-width="2" />
      </svg>
    </a>

    <!-- Header -->
    <header class="header-container">
      
      <!-- √Årea din√¢mica ao logar: notifica√ß√µes + sair -->
      <div class="user-actions">
        <button
          class="volunteer-btn"
          onclick="openModal('volunteerModal')"
          aria-label="Abrir doa√ß√µes volunt√°rias"
          id="volunteerButton"
          style="display:none"
        >
          <span class="volunteer-icon-mobile">‚ù§Ô∏è</span>
          <span class="volunteer-text">Doa√ß√µes Volunt√°rias</span>
        </button>

        <div class="notif-wrap" id="notifWrap" style="display:none">
          <button class="btn btn-info" id="notifBtn" onclick="toggleNotifications()" aria-haspopup="true" aria-expanded="false">
            üîî Notifica√ß√µes <span class="badge-count" id="notifCount" hidden>0</span>
          </button>
          <div class="notif-dropdown" id="notifDropdown" hidden>
            <ul class="notif-list" id="notifList"></ul>
            <div class="notif-footer">
              <button class="btn btn-warning" onclick="clearAllNotifications()">Limpar</button>
            </div>
          </div>
        </div>

        <button class="btn btn-danger" id="logoutBtn" onclick="logout()" style="display:none">Sair</button>
      </div>
    </header>

    <div class="container">
      <div class="form-logo">
        <img src="../imgs/logo.png" alt="Logomarca da Ecolink" />
      </div>
      <nav class="nav-tabs" id="authTabs" role="tablist" aria-label="Abas principais">
        <button
          class="nav-tab active"
          id="loginTab"
          onclick="showScreen('login', event)"
          aria-controls="login"
          aria-selected="true"
        >
          Login
        </button>
        <button
          class="nav-tab"
          id="registerTab"
          onclick="showScreen('register', event)"
          aria-controls="register"
          aria-selected="false"
        >
          Cadastro
        </button>
      </nav>

      <main class="content">
        <!-- LOGIN -->
        <section id="login" class="screen active" aria-labelledby="login-title">
          <h2 id="login-title" class="section-title">Acesse sua conta</h2>
          <form id="loginForm" onsubmit="handleLogin(event)" autocomplete="off">
            <div class="form-group">
              <label for="loginUser">Usu√°rio</label>
              <input type="text" id="loginUser" required />
            </div>
            <div class="form-group">
              <label for="loginPassword">Senha</label>
              <input type="password" id="loginPassword" required />
            </div>
            <button type="submit" class="btn btn-primary">Entrar</button>
          </form>
        </section>

        <!-- CADASTRO -->
        <section id="register" class="screen" aria-labelledby="register-title">
          <h2 id="register-title" class="section-title">Novo Cadastro</h2>

          <h3 class="subsection-title">Selecione o tipo de usu√°rio</h3>
          <div class="tier-selector">
            <div class="tier-card" onclick="selectUserType('doador', event)" role="button" tabindex="0">
              <div class="tier-icon">üì¶</div>
              <h3>Doador</h3>
              <p>Empresas que descartam res√≠duos t√™xteis</p>
            </div>
            <div class="tier-card" onclick="selectUserType('recebedor', event)" role="button" tabindex="0">
              <div class="tier-icon">‚ôªÔ∏è</div>
              <h3>Recebedor</h3>
              <p>Empresas que recebem e processam res√≠duos</p>
            </div>
            <div class="tier-card" onclick="selectUserType('transportador', event)" role="button" tabindex="0">
              <div class="tier-icon">üöö</div>
              <h3>Transportador</h3>
              <p>Empresas que realizam o transporte</p>
            </div>
          </div>

          <!-- Subtipo de transporte -->
          <div id="transportTypeSelection" style="display: none">
            <h3 class="subsection-title">Selecione o tipo de transporte</h3>
            <div class="tier-selector">
              <div class="tier-card transport-type" onclick="selectTransportType('moto', event)">
                <div class="tier-icon">üèçÔ∏è</div>
                <h3>Moto</h3>
                <p>Entregas r√°pidas e √°geis</p>
              </div>
              <div class="tier-card transport-type" onclick="selectTransportType('carro', event)">
                <div class="tier-icon">üöó</div>
                <h3>Carro</h3>
                <p>M√©dio porte</p>
              </div>
              <div class="tier-card transport-type" onclick="selectTransportType('caminhao', event)">
                <div class="tier-icon">üöõ</div>
                <h3>Caminh√£o</h3>
                <p>Grande capacidade</p>
              </div>
            </div>
          </div>

          <!-- PLANOS -->
          <div id="tierSelection" style="display: none">
            <h3 class="subsection-title">Selecione o plano</h3>
            <div class="tier-selector" id="planCards"></div>

            <h3 class="subsection-title" style="margin-top: 20px">Periodicidade do Pagamento</h3>
            <div class="form-group">
              <select id="planPeriodicity" onchange="updatePlanPriceDisplay()" required>
                <option value="mensal">Mensal</option>
                <option value="trimestral">Trimestral (5% de Desconto)</option>
                <option value="semestral">Semestral (10% de Desconto)</option>
                <option value="anual">Anual (15% de Desconto)</option>
              </select>
            </div>
          </div>

          <!-- FORMUL√ÅRIO DE CADASTRO -->
          <form id="registerForm" style="display: none" onsubmit="handleRegister(event)" autocomplete="on" novalidate>
            <div class="form-row">
              <div class="form-group">
                <label for="regName">Nome Completo / Raz√£o Social</label>
                <input type="text" id="regName" required />
              </div>
              <div class="form-group">
                <label for="regDoc">CPF / CNPJ</label>
                <input type="text" id="regDoc" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regEmail">Email</label>
                <input type="email" id="regEmail" required />
              </div>
              <div class="form-group">
                <label for="regPhone">Telefone</label>
                <input type="tel" id="regPhone" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regUsername">Nome de Usu√°rio</label>
                <input type="text" id="regUsername" required />
              </div>
              <div class="form-group">
                <label for="regPassword">Senha</label>
                <input type="password" id="regPassword" required oninput="checkPasswordStrength(this.value)" />
                <div id="passwordStrength" class="password-strength"></div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regCep">CEP</label>
                <input
                  type="text"
                  id="regCep"
                  required
                  maxlength="9"
                  placeholder="00000-000"
                  onblur="buscarCep('reg', this.value)"
                />
                <span id="regCepLoading" class="loading" style="display: none">Buscando CEP...</span>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regLogradouro">Logradouro</label>
                <input type="text" id="regLogradouro" required />
              </div>
              <div class="form-group">
                <label for="regNumero">N√∫mero</label>
                <input type="text" id="regNumero" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regComplemento">Complemento</label>
                <input type="text" id="regComplemento" />
              </div>
              <div class="form-group">
                <label for="regBairro">Bairro</label>
                <input type="text" id="regBairro" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regCidade">Cidade</label>
                <input type="text" id="regCidade" required />
              </div>
              <div class="form-group">
                <label for="regEstado">Estado (UF)</label>
                <input type="text" id="regEstado" required maxlength="2" />
              </div>
            </div>

            <!-- Campos de ve√≠culo/CNH (transportador) -->
            <fieldset id="vehicleFields" style="display: none; margin-top: 20px">
              <legend>Dados do Ve√≠culo</legend>
              <div class="form-row">
                <div class="form-group">
                  <label for="vehicleRenavam">RENAVAM</label>
                  <input type="text" id="vehicleRenavam" maxlength="11" />
                </div>
                <div class="form-group">
                  <label for="vehiclePlaca">Placa</label>
                  <input type="text" id="vehiclePlaca" maxlength="7" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="vehicleModelo">Modelo</label>
                  <input type="text" id="vehicleModelo" />
                </div>
                <div class="form-group">
                  <label for="vehicleAno">Ano</label>
                  <input type="number" id="vehicleAno" maxlength="4" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="vehicleCor">Cor</label>
                  <input type="text" id="vehicleCor" />
                </div>
                <div class="form-group">
                  <label for="freightRate">Tarifa de Frete (R$/km)</label>
                  <input type="number" id="freightRate" step="0.01" min="0.10" />
                </div>
              </div>
            </fieldset>

            <fieldset id="cnhFields" style="display: none; margin-top: 20px">
              <legend>Dados da CNH</legend>
              <div class="form-row">
                <div class="form-group">
                  <label for="cnhNumero">N√∫mero de Registro</label>
                  <input type="text" id="cnhNumero" />
                </div>
                <div class="form-group">
                  <label for="cnhCategoria">Categoria</label>
                  <select id="cnhCategoria">
                    <option value="">Selecione</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="cnhValidade">Data de Validade</label>
                  <input type="date" id="cnhValidade" />
                </div>
              </div>
            </fieldset>

            <!-- PAGAMENTO DO PLANO -->
            <fieldset id="paymentSection" style="display: none; margin-top: 20px">
              <legend>Pagamento do Plano</legend>

              <div id="planSummary" class="tier-summary" style="display: none">
                <span id="planSummaryText" style="flex: 1"></span>
                <span id="planSummaryTotal" style="font-weight: 800; font-size: 1.1em; color: var(--primary-green)"></span>
              </div>

              <h4 class="subsection-title" style="margin-top: 0">Selecione o M√©todo de Pagamento</h4>
              <div class="payment-method-selector">
                <label class="radio-label">
                  <input type="radio" name="paymentMethod" value="pix" onchange="showPaymentFields('plan', 'pix')" />
                  <span class="icon-label"><span class="icon">üì±</span> PIX</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="paymentMethod" value="transfer" onchange="showPaymentFields('plan', 'transfer')" />
                  <span class="icon-label"><span class="icon">üè¶</span> Transfer√™ncia Banc√°ria</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="paymentMethod" value="debit" onchange="showPaymentFields('plan', 'debit')" />
                  <span class="icon-label"><span class="icon">üí≥</span> Cart√£o de D√©bito</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="paymentMethod" value="credit" onchange="showPaymentFields('plan', 'credit')" />
                  <span class="icon-label"><span class="icon">üí≥</span> Cart√£o de Cr√©dito</span>
                </label>
              </div>

              <div id="planPixDetails" class="payment-details" style="display: none">
                <p><strong>Chave PIX (CNPJ):</strong> 00.000.000/0001-00</p>
                <p style="font-size: 0.9em; color: var(--danger)">O cadastro s√≥ ser√° finalizado ap√≥s a confirma√ß√£o do pagamento.</p>
              </div>

              <div id="planTransferDetails" class="payment-details" style="display: none">
                <p><strong>Banco:</strong> 001 - Banco do Brasil</p>
                <p><strong>Ag√™ncia:</strong> 1234-5</p>
                <p><strong>Conta:</strong> 67890-0 (Pessoa Jur√≠dica)</p>
                <p style="font-size: 0.9em; color: var(--danger)">O cadastro s√≥ ser√° finalizado ap√≥s a confirma√ß√£o do pagamento.</p>
              </div>

              <div id="planCardDetails" class="payment-details card-details" style="display: none">
                <div class="form-group">
                  <label for="planCardNumber">N√∫mero do Cart√£o</label>
                  <input type="text" id="planCardNumber" maxlength="19" placeholder="0000 0000 0000 0000" oninput="formatCardNumber(this)" />
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="planCardName">Nome no Cart√£o</label>
                    <input type="text" id="planCardName" placeholder="Como est√° no cart√£o" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="planCardExpiry">Validade</label>
                    <input type="text" id="planCardExpiry" maxlength="5" placeholder="MM/AA" oninput="formatExpiry(this)" />
                  </div>
                  <div class="form-group">
                    <label for="planCardCvv">CVV</label>
                    <input type="text" id="planCardCvv" maxlength="4" placeholder="123" />
                  </div>
                </div>
              </div>
            </fieldset>

            <button class="btn btn-primary" type="submit" id="regSubmitBtn" style="margin-top: 1.5rem">
              Finalizar Cadastro e Pagar
            </button>
          </form>
        </section>

        <!-- DASHBOARD -->
        <section id="dashboard" class="screen" aria-labelledby="dashboard-title">
          <h2 id="dashboard-title" class="section-title">Dashboard</h2>
          <p><strong id="userName"></strong></p>
          <p id="userType"></p>

          <!-- Doador -->
          <div id="doadorDash" style="display: none">
            <h3 class="section-title">Painel do Doador</h3>
            <div class="dashboard">
              <div class="stat-card green">
                <div class="stat-value" id="co2Saved">0</div>
                <div class="stat-label">kg de CO¬≤ evitados</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="waterSaved">0</div>
                <div class="stat-label">Litros de √°gua poupados</div>
              </div>
              <div class="stat-card green">
                <div class="stat-value" id="landfillSaved">0</div>
                <div class="stat-label">kg de res√≠duos desviados</div>
              </div>
            </div>

            <button class="btn btn-primary" onclick="openModal('newDonationModal')">Registrar Nova Doa√ß√£o</button>

            <h3 class="table-title">Minhas Doa√ß√µes Recentes</h3>
            <div class="table-container">
              <table id="donorDonationsTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Tipo</th>
                    <th>Peso (kg)</th>
                    <th>Data</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <h3 class="table-title">Notifica√ß√µes</h3>
            <div id="donorNotifications" class="notifications"></div>
          </div>

          <!-- Recebedor -->
          <div id="recebedorDash" style="display: none">
            <h3 class="table-title">Doa√ß√µes Dispon√≠veis</h3>
            <div id="receiverNotifications" class="notifications"></div>
            <div class="table-container">
              <table id="availableDonationsTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Categoria</th>
                    <th>Peso (kg)</th>
                    <th>Data</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <!-- Transportador -->
          <div id="transportadorDash" style="display: none">
            <h3 class="table-title">Coletas Dispon√≠veis</h3>
            <div id="transportNotifications" class="notifications"></div>
            <div class="table-container">
              <table id="availablePickupsTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Doador (Coleta)</th>
                    <th>Recebedor (Entrega)</th>
                    <th>Peso (kg)</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- MODAL DOA√á√ïES VOLUNT√ÅRIAS -->
    <div id="volunteerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="volunteer-modal-title">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('volunteerModal')" aria-label="Fechar Doa√ß√µes Volunt√°rias">&times;</span>
        <h2 id="volunteer-modal-title" class="section-title" style="margin-top: 0">Doa√ß√µes Volunt√°rias & Car√™ncias</h2>

        <form id="volunteerForm" onsubmit="handleVolunteerDonation(event)">
          <!-- PERFIL -->
          <fieldset>
            <legend>Tipo de Participante</legend>
            <div class="tier-selector card-choices" id="volunteerProfiles">
              <label class="tier-card as-label">
                <input type="radio" name="volunteerUserType" value="doador" onchange="updateVolunteerFormVisibility()" required />
                <div class="tier-icon">üéÅ</div>
                <h3>Doador Volunt√°rio</h3>
                <p>Quero doar valores/itens</p>
              </label>

              <label class="tier-card as-label">
                <input type="radio" name="volunteerUserType" value="instituicao" onchange="updateVolunteerFormVisibility()" />
                <div class="tier-icon">ü§ù</div>
                <h3>Institui√ß√£o (Car√™ncia)</h3>
                <p>Preciso receber ajuda</p>
              </label>
            </div>
          </fieldset>

          <!-- TIPO DE DOA√á√ÉO -->
          <fieldset id="donationTypeSelection" style="margin-top: 20px; display: none">
            <legend id="donationTypeLegend">Selecione o Tipo de Doa√ß√£o</legend>
            <div class="tier-selector card-choices">
              <label class="tier-card as-label">
                <input type="radio" name="volunteerDonationType" value="valor" onchange="updateVolunteerFormVisibility()" />
                <div class="tier-icon">üí∞</div>
                <h3>Valor em Dinheiro</h3>
                <p>PIX, transfer√™ncia ou cart√£o</p>
              </label>
              <label class="tier-card as-label">
                <input type="radio" name="volunteerDonationType" value="roupas" onchange="updateVolunteerFormVisibility()" />
                <div class="tier-icon">üëö</div>
                <h3>Roupas/T√™xteis</h3>
                <p>Agende coleta/entrega</p>
              </label>
              <label class="tier-card as-label">
                <input type="radio" name="volunteerDonationType" value="alimentos" onchange="updateVolunteerFormVisibility()" />
                <div class="tier-icon">üçé</div>
                <h3>Alimentos/Cestas</h3>
                <p>Itens n√£o perec√≠veis</p>
              </label>
            </div>
          </fieldset>

          <!-- CONTATO -->
          <fieldset id="volunteerContactFields" style="margin-top: 20px; display: none">
            <legend>Informa√ß√µes de Contato</legend>
            <div class="form-row">
              <div class="form-group">
                <label for="volunteerName">Nome / Institui√ß√£o</label>
                <input type="text" id="volunteerName" />
              </div>
              <div class="form-group">
                <label for="volunteerCpfCnpj">CPF / CNPJ</label>
                <input type="text" id="volunteerCpfCnpj" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="volunteerEmail">Email</label>
                <input type="email" id="volunteerEmail" />
              </div>
              <div class="form-group">
                <label for="volunteerPhone">Telefone</label>
                <input type="tel" id="volunteerPhone" />
              </div>
            </div>
          </fieldset>

          <!-- VALOR EM DINHEIRO + M√âTODO DE PAGAMENTO -->
          <fieldset id="volunteerValueFields" style="margin-top: 20px; display: none">
            <legend id="donationDetailsLegend">Detalhes da Doa√ß√£o</legend>

            <div id="donationDetails" class="payment-details card-details" style="display: none">
              <div class="form-group">
                <label for="volunteerValue">Valor da Doa√ß√£o (R$)</label>
                <input type="number" id="volunteerValue" step="0.01" min="5.00" />
              </div>

              <h4 class="subsection-title" style="margin-top: 15px">M√©todo de Pagamento</h4>
              <div class="payment-method-selector">
                <label class="radio-label">
                  <input type="radio" name="volunteerPaymentMethod" value="pix" onchange="showPaymentFields('volunteer', 'pix')" />
                  <span class="icon-label"><span class="icon">üì±</span> PIX</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="volunteerPaymentMethod" value="transfer" onchange="showPaymentFields('volunteer', 'transfer')" />
                  <span class="icon-label"><span class="icon">üè¶</span> Transfer√™ncia</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="volunteerPaymentMethod" value="credit" onchange="showPaymentFields('volunteer', 'credit')" />
                  <span class="icon-label"><span class="icon">üí≥</span> Cart√£o de Cr√©dito</span>
                </label>
              </div>

              <div id="volunteerPixDetails" class="payment-details" style="display: none; margin-top: 10px">
                <p><strong>Chave PIX Ecolink (CNPJ):</strong> 00.000.000/0001-00</p>
                <p style="font-size: 0.9em; color: var(--danger)">Sua doa√ß√£o ser√° processada ap√≥s a transfer√™ncia para a chave acima.</p>
              </div>

              <div id="volunteerTransferDetails" class="payment-details" style="display: none; margin-top: 10px">
                <p>
                  <strong>Banco:</strong> 001 - Banco do Brasil |
                  <strong>Ag√™ncia:</strong> 1234-5 |
                  <strong>Conta:</strong> 67890-0
                </p>
                <p style="font-size: 0.9em; color: var(--danger)">Envie o comprovante para o nosso e-mail.</p>
              </div>

              <div id="volunteerCardDetails" class="payment-details card-details" style="display: none">
                <div class="form-group">
                  <label for="volunteerCardNumber">N√∫mero do Cart√£o</label>
                  <input type="text" id="volunteerCardNumber" maxlength="19" placeholder="0000 0000 0000 0000" oninput="formatCardNumber(this)" />
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="volunteerCardName">Nome no Cart√£o</label>
                    <input type="text" id="volunteerCardName" placeholder="Como est√° no cart√£o" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="volunteerCardExpiry">Validade</label>
                    <input type="text" id="volunteerCardExpiry" maxlength="5" placeholder="MM/AA" oninput="formatExpiry(this)" />
                  </div>
                  <div class="form-group">
                    <label for="volunteerCardCvv">CVV</label>
                    <input type="text" id="volunteerCardCvv" maxlength="4" placeholder="123" />
                  </div>
                </div>
              </div>
            </div>

            <div id="volunteerReceivingFields" style="display: none">
              <div class="form-group">
                <label for="volunteerValueNeeded">Valor de Car√™ncia (R$)</label>
                <input type="number" id="volunteerValueNeeded" step="0.01" min="5.00" />
              </div>
              <h4 style="margin-top: 15px">Dados Banc√°rios para Recebimento</h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="volunteerBank">Banco</label>
                  <input type="text" id="volunteerBank" />
                </div>
                <div class="form-group">
                  <label for="volunteerAgency">Ag√™ncia</label>
                  <input type="text" id="volunteerAgency" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="volunteerAccount">Conta com D√≠gito</label>
                  <input type="text" id="volunteerAccount" />
                </div>
                <div class="form-group">
                  <label for="volunteerAccountType">Tipo de Conta</label>
                  <select id="volunteerAccountType">
                    <option value="">Selecione...</option>
                    <option value="corrente">Conta Corrente</option>
                    <option value="poupanca">Conta Poupan√ßa</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="form-group" id="volunteerNotesGroup" style="display: none">
              <label for="volunteerNotes" id="volunteerNotesLabel">Notas ou Pedidos Espec√≠ficos:</label>
              <textarea id="volunteerNotes" rows="3"></textarea>
            </div>

            <div id="volunteerItemFields" style="display: none">
              <div class="form-group">
                <label for="volunteerItemDescription" id="itemDescriptionLabel">Descri√ß√£o dos Itens:</label>
                <textarea id="volunteerItemDescription" rows="4"></textarea>
              </div>
              <p id="volunteerItemHelpText" style="font-size: 0.9em; color: var(--info)">
                A Ecolink entrar√° em contato para agendar a coleta no endere√ßo informado.
              </p>
            </div>
          </fieldset>

          <fieldset id="volunteerAddressFields" style="margin-top: 20px; display: none">
            <legend>Endere√ßo</legend>
            <div class="form-group">
              <label for="volunteerCep">CEP</label>
              <input
                type="text"
                id="volunteerCep"
                maxlength="9"
                placeholder="00000-000"
                onblur="buscarCep('volunteer', this.value)"
              />
              <span id="volunteerCepLoading" class="loading" style="display: none">Buscando CEP...</span>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="volunteerLogradouro">Logradouro</label>
                <input type="text" id="volunteerLogradouro" />
              </div>
              <div class="form-group">
                <label for="volunteerNumero">N√∫mero</label>
                <input type="text" id="volunteerNumero" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="volunteerBairro">Bairro</label>
                <input type="text" id="volunteerBairro" />
              </div>
              <div class="form-group">
                <label for="volunteerCidade">Cidade</label>
                <input type="text" id="volunteerCidade" />
              </div>
            </div>
            <div class="form-group">
              <label for="volunteerComplemento">Complemento</label>
              <input type="text" id="volunteerComplemento" />
            </div>
          </fieldset>

          <button type="submit" class="btn btn-primary" id="volunteerSubmitBtn" style="margin-top: 20px; display: none">
            Finalizar
          </button>
        </form>
      </div>
    </div>

    <!-- MODAL NOVA DOA√á√ÉO -->
    <div id="newDonationModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="new-donation-title">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('newDonationModal')">&times;</span>
        <h2 id="new-donation-title" class="section-title">Registrar Nova Doa√ß√£o</h2>

        <form id="newDonationForm" onsubmit="handleNewDonation(event)">
          <div class="form-group">
            <label for="donationCategory">Tipo de Res√≠duo</label>
            <input type="text" id="donationCategory" required placeholder="Ex: Retalhos de algod√£o, Jeans..." />
          </div>
          <div class="form-group">
            <label for="donationWeight">Peso Aproximado (kg)</label>
            <input type="number" id="donationWeight" step="0.1" min="1" required />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="donationPhone">Telefone para Coleta</label>
              <input type="tel" id="donationPhone" required />
            </div>
            <div class="form-group">
              <label for="donationEmail">Email de Contato</label>
              <input type="email" id="donationEmail" required />
            </div>
          </div>
          <div class="form-group">
            <label for="donationNotes">Observa√ß√µes (ex: melhor hor√°rio, local exato)</label>
            <textarea id="donationNotes" rows="3"></textarea>
          </div>

          <button type="submit" class="btn btn-primary">Registrar</button>
        </form>
      </div>
    </div>

    <!-- MODAL RASTREAMENTO -->
    <div id="trackingModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tracking-title">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('trackingModal')">&times;</span>
        <h2 id="tracking-title" class="section-title">Rastreamento da Doa√ß√£o</h2>
        <div id="trackingBody"></div>
      </div>
    </div>

    <div class="toast hidden" id="toast">Notifica√ß√£o aqui</div>

    <script src="../js/script.js"></script>

    <script>
      // Estado inicial de telas
      loadFromLocalStorage();
      if (state.currentUser) {
        loadDashboard();
        requestNotificationPermissionOnce();
      } else {
        const hash = window.location.hash.substring(1);
        if (hash === "login" || hash === "register") {
          showScreen(hash);
        } else {
          showScreen("login");
        }
      }
    </script>
  </body>
</html>
